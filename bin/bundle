def activate_bundler
  gem_error = activation_error_handling { gem 'bundler', bundler_requirement }
  return if gem_error.nil?

  handle_activation_error(gem_error)
end

def handle_activation_error(gem_error)
  require_error = activation_error_handling { require 'bundler/version' }
  return if require_error.nil? && Gem::Requirement.new(bundler_requirement).satisfied_by?(Gem::Version.new(Bundler::VERSION))

  warn_activation_failure(gem_error)
  exit 42
end

def warn_activation_failure(gem_error)
  warn "Activating bundler (#{bundler_requirement}) failed:\n#{gem_error.message}\n\n " \
       'To install the version of bundler this project requires, run ' \
       "`gem install bundler -v '#{bundler_requirement}'`"
end